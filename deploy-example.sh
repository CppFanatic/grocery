#!/bin/bash

# =============================================================================
# –ü–†–ò–ú–ï–† –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò –î–õ–Ø –ë–´–°–¢–†–û–ì–û –°–¢–ê–†–¢–ê
# =============================================================================

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ deploy-to-s3.sh –∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥ –≤–∞—à –ø—Ä–æ–µ–∫—Ç

# =============================================================================
# –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø S3 –ë–ê–ö–ï–¢–ê
# =============================================================================

# –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–∞–∫–µ—Ç–∞
BUCKET_NAME="my-delivery-pwa-$(date +%s)"              # –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Å timestamp
REGION="us-east-1"                                      # –†–µ–≥–∏–æ–Ω AWS
PROFILE=""                                              # AWS –ø—Ä–æ—Ñ–∏–ª—å (–ø—É—Å—Ç–æ–π = default)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
CACHE_CONTROL_STATIC="public, max-age=31536000"         # 1 –≥–æ–¥ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
CACHE_CONTROL_HTML="public, max-age=0, must-revalidate" # –ù–µ—Ç –∫—ç—à–∞ –¥–ª—è HTML
CACHE_CONTROL_SW="public, max-age=0, must-revalidate"   # –ù–µ—Ç –∫—ç—à–∞ –¥–ª—è Service Worker

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ CORS (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
ENABLE_CORS=true
CORS_CONFIG_FILE="cors-config.json"

# =============================================================================
# –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –°–û–ó–î–ê–ù–ò–ï –ë–ê–ö–ï–¢–ê
# =============================================================================

echo "üöÄ –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π S3 –±–∞–∫–µ—Ç –¥–ª—è PWA..."

# –°–æ–∑–¥–∞–µ–º –±–∞–∫–µ—Ç
if [ -n "$PROFILE" ] && [ "$PROFILE" != "default" ]; then
    aws s3 mb "s3://$BUCKET_NAME" --profile "$PROFILE" --region "$REGION"
else
    aws s3 mb "s3://$BUCKET_NAME" --region "$REGION"
fi

echo "‚úÖ –ë–∞–∫–µ—Ç $BUCKET_NAME —Å–æ–∑–¥–∞–Ω –≤ —Ä–µ–≥–∏–æ–Ω–µ $REGION"
echo ""

# =============================================================================
# –ó–ê–ü–£–°–ö –û–°–ù–û–í–ù–û–ì–û –°–ö–†–ò–ü–¢–ê –î–ï–ü–õ–û–Ø
# =============================================================================

echo "üì§ –ó–∞–ø—É—Å–∫–∞–µ–º –¥–µ–ø–ª–æ–π..."
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
./deploy-to-s3.sh

echo ""
echo "üéâ –ì–æ—Ç–æ–≤–æ! –í–∞—à–µ PWA —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –Ω–∞:"
echo "   üåê http://$BUCKET_NAME.s3-website-$REGION.amazonaws.com"
echo ""
echo "üí° –ù–µ –∑–∞–±—É–¥—å—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–º—è –±–∞–∫–µ—Ç–∞: $BUCKET_NAME"
